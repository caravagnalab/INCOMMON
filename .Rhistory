setwd("~/Documents/GitHub/TAPACLOTH/")
x = readRDS("~/TAPACLOTH/data/tapacloth_input/P-0044501-T01-IM6.rds")
x
x$purity
stopifnot(inherits(x, "TAPACLOTH"))
eps=1
# Prepare data for BMix
input = data.frame(successes = get_data(x) %>% pull(NV),
trials = get_data(x) %>% pull(DP))
library(tidyverse)
devtools::load_all()
# Prepare data for BMix
input = data.frame(successes = get_data(x) %>% pull(NV),
trials = get_data(x) %>% pull(DP))
input
fit = BMix::bmixfit(input, K.Binomials = 0, K.BetaBinomials = 1:3)
n_binomials = fit$K["BB"]
peaks = sort(fit$BB.params["mu",]) %>% as.double()
n_binomials
peaks
purity
purity = get_purity(x)
purity
eps
out = NA
n_binomials
n_binomials == 2 & !is.na(purity)
min(abs(peaks[1] * 2 - purity), abs(peaks[2] * 2 - purity))
peaks
abs(peaks[1] * 2)
peaks[2] * 2
min(peaks[2] * 2, 1)
min(abs(purity_h1 - purity), abs(purity_h2 - purity))
purity_h1 = peaks[1] * 2
purity_h2 = min(peaks[2] * 2, 1)
min(abs(purity_h1 - purity), abs(purity_h2 - purity))
min(abs(purity_h1 - purity), abs(purity_h2 - purity)) <= eps
out = peaks[which.min(c(abs(purity_h1 - purity), abs(purity_h1 - purity)))] * 2
out
out
out = peaks[which.min(c(abs(purity_h1 - purity), abs(purity_h2 - purity)))] * 2
out
purity_h2
purity_h2 = min(peaks[2] * 2, 1)
out = peaks[which.min(c(abs(purity_h1 - purity), abs(purity_h2 - purity)))] * 2
out
purity_hyp = c(min(peaks[1] * 2, 1), min(peaks[2] * 2, 1))
purity_hyp
purity_hyp-purity
abs(purity_hyp-purity)
min(abs(purity_hyp-purity))
whichmin(abs(purity_hyp-purity))
which.min(abs(purity_hyp-purity))
purity_hyp = which.min(abs(purity_hyp-purity))
purity_hyp = c(min(peaks[1] * 2, 1), min(peaks[2] * 2, 1))
purity_hyp[which.min(abs(purity_hyp-purity))]
abs(purity_hyp-purity)
!is.na(purity) & min(abs(purity_hyp-purity)) <= eps
devtools::install_github("caravagnalab/TAPACLOTH")
