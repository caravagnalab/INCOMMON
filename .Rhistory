survival_status = 'OS_STATUS'
formula = paste0('survival::Surv(',survival_time,', ',survival_status,') ~ group')
formula
!('survival' %in% names(x))
devtools::load_all()
cox_fit(x = classified_data, tumor_type = 'PAAD', gene = 'KRAS',
survival_time = 'OS_MONTHS',
survival_status = 'OS_STATUS',
covariates = c('age', 'sex', 'tmb'))
cox_fit(x = x,
tumor_type = 'PAAD',
gene = 'KRAS',
survival_time = 'OS_MONTHS',
survival_status = 'OS_STATUS',
covariates = c('age', 'sex', 'tmb'))
tumor_type
devtools::load_all()
devtools::load_all()
x$survival
cox_fit(x = x,
tumor_type = 'PAAD',
gene = 'KRAS',
survival_time = 'OS_MONTHS',
survival_status = 'OS_STATUS',
covariates = c('age', 'sex', 'tmb'))
devtools::load_all()
cox_fit(x = x,
tumor_type = 'PAAD',
gene = 'KRAS',
survival_time = 'OS_MONTHS',
survival_status = 'OS_STATUS',
covariates = c('age', 'sex', 'tmb'))
devtools::load_all()
cox_fit(x = x,
tumor_type = 'PAAD',
gene = 'KRAS',
survival_time = 'OS_MONTHS',
survival_status = 'OS_STATUS',
covariates = c('age', 'sex', 'tmb'))
data = prepare_km_fit_input(x, tumor_type, gene)
formula = paste0('survival::Surv(',survival_time,', ',survival_status,') ~ group')
for(c in covariates) {
what = grep(c, colnames(data), ignore.case = T, value = TRUE)
for(w in what) {
if(is.numeric(data[[w]])){
q =  quantile(data[w], na.rm = T)['50%']
data[[w]] = ifelse(data[[w]] > q, paste0('>', round(q, 0)), paste0('<=', round(q, 0)))
data[[w]] = factor(data[[w]])
data[[w]] = relevel(data[[w]], ref = grep('<=', unique(data[[w]]), value = T))
}
formula = paste(formula, w, sep = ' + ')
}
}
data %>%
dplyr::mutate(group = factor(class)) %>%
dplyr::mutate(group = relevel(group, ref = grep('WT', unique(data$group), value = T)))
devtools::load_all()
cox_fit(x = x,
tumor_type = 'PAAD',
gene = 'KRAS',
survival_time = 'OS_MONTHS',
survival_status = 'OS_STATUS',
covariates = c('age', 'sex', 'tmb'))
y = cox_fit(x = x,
tumor_type = 'PAAD',
gene = 'KRAS',
survival_time = 'OS_MONTHS',
survival_status = 'OS_STATUS',
covariates = c('age', 'sex', 'tmb'))
y
devtools::load_all()
y = cox_fit(x = x,
tumor_type = 'PAAD',
gene = 'KRAS',
survival_time = 'OS_MONTHS',
survival_status = 'OS_STATUS',
covariates = c('age', 'sex', 'tmb'))
y
y$survival$PAAD$KRAS$`kaplan-meier`
y$survival$PAAD$KRAS$cox_regression
rm(x)
x = y
x = cox_fit(x = x,
tumor_type = 'PAAD',
gene = 'KRAS',
survival_time = 'OS_MONTHS',
survival_status = 'OS_STATUS',
covariates = c('age', 'sex', 'tmb'))
stopifnot(inherits(x, 'INCOMMON'))
stopifnot('survival' %in% names(x))
stopifnot(tumor_type %in% names(x$survival)))
stopifnot(gene %in% names(x$survival[[tumor_type]]))
stopifnot(tumor_type %in% names(x$survival))
stopifnot(gene %in% names(x$survival[[tumor_type]]))
km_fit = x$survival[[tumor_type]][[gene]]$`kaplan-meier`
km_fit
x$survival[[tumor_type]][[gene]]$`cox_fit`
x$survival[[tumor_type]][[gene]]
x$survival[[tumor_type]][[gene]]$cox_regression
x$survival[[tumor_type]][[gene]]$cox_regression$data
x$survival[[tumor_type]][[gene]]$cox_regression$xlevels
devtools::load_all()
plot_survival_analysis(x = classified_data,
tumor_type = 'PAAD',
gene = 'KRAS')
plot_survival_analysis(x = x,
tumor_type = 'PAAD',
gene = 'KRAS')
devtools::load_all()
library(dplyr)
data(MSK_genomic_data)
data(MSK_clinical_data)
data(cancer_gene_census)
x = init(
genomic_data = MSK_genomic_data,
clinical_data = MSK_clinical_data %>% filter(tumor_type == 'BRCA'),
gene_roles = cancer_gene_census
)
print(x)
x = classify(
x = x,
priors = pcawg_priors,
entropy_cutoff = 0.2,
rho = 0.01
)
print(x)
gene
classification(x)
stopifnot(inherits(x, 'INCOMMON'))
classification(x)
!("genotype" %in% (classification(x) %>% names()))
x = genome_interpreter(x)
classification(x) %>%
dplyr::filter(class != 'Tier-2')
classification(x) %>%
dplyr::filter(class != 'Tier-2') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary')
classification(x) %>%
dplyr::filter(class != 'Tier-2') %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary')
dplyr::mutate(metastatic = 1*(MET_COUNT > 0)) %>%
dplyr::select(sample, tumor_type, gene, class, metastatic)
classification(x) %>%
dplyr::filter(class != 'Tier-2') %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0)) %>%
dplyr::select(sample, tumor_type, gene, class, metastatic)
classification(x) %>%
dplyr::filter(class != 'Tier-2') %>%
dplyr::left_join(clinical_data(x), by = 'sample')
tumor_type = 'BRCA'
gene = 'TP53'
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene)
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1)
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::filter(class != 'Tier-2')
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::filter(class != 'Tier-2') %>%
dplyr::left_join(clinical_data(x), by = 'sample')
classification(x) %>%
dplyr::filter(class != 'Tier-2') %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class))
classification(x) %>%
dplyr::filter(class != 'Tier-2') %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0)) %>%
dplyr::select(sample, tumor_type, gene, class, metastatic)
classification(x) %>%
dplyr::filter(class != 'Tier-2') %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0))
classification(x) %>%
dplyr::filter(class != 'Tier-2') %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0)) %>%
dplyr::select(sample, tumor_type, gene, class, metastatic)
classification(x) %>%
dplyr::filter(class != 'Tier-2') %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0))
classification(x) %>%
dplyr::filter(class != 'Tier-2') %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0))
classification(x) %>%
dplyr::filter(class != 'Tier-2') %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0)) %>% pull(class) %>% table()
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(class != 'Tier-2') %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0))
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(class != 'Tier-2') %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0))%>% pull(class) %>% table()
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(state != 'Tier-2') %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0))
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(state != 'Tier-2') %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0)) %>% pull(class) %>% table()
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(!grepl('Tier-2', class)) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0))
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(!grepl('Tier-2', class)) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0)) %>% pull(class) %>% table()
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(!grepl('Tier-2', class)) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0))
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(!grepl('Tier-2', class)) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0)) %>%
dplyr::select(class, metastatic)
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(!grepl('Tier-2', class)) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0)) %>%
dplyr::select(class, metastatic) %>% table()
data = classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(!grepl('Tier-2', class)) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Primary') %>%
dplyr::mutate(metastatic = 1*(MET_COUNT > 0)) %>%
dplyr::select(class, metastatic)
data
model = stats::glm(data = data, metastatic ~ class, family = binomial(link = 'logit'))
fit = cbind(summary(model)$coefficients, confint(model)) %>% as_tibble()
fit$var = rownames(confint(model)) %>% gsub('class', '', .)
dplyr::tibble(
gene = g,
N = unique(what$N),
class = fit[2,]$var,
OR = fit[2,]$Estimate %>% exp(),
low = fit[2,]$`2.5 %` %>% exp(),
up = fit[2,]$`97.5 %` %>% exp(),
p.value = fit[2,]$`Pr(>|z|)`
)
dplyr::tibble(
gene = gene,
# N = unique(data$N),
class = fit[2,]$var,
OR = fit[2,]$Estimate %>% exp(),
low = fit[2,]$`2.5 %` %>% exp(),
up = fit[2,]$`97.5 %` %>% exp(),
p.value = fit[2,]$`Pr(>|z|)`
)
data = data %>%
dplyr::mutate(class = factor(class)) %>%
dplyr::mutate(class = stats::relevel(class, ref = grep('without', unique(data$class), value = T)))
model = stats::glm(data = data, metastatic ~ class, family = binomial(link = 'logit'))
fit = cbind(summary(model)$coefficients, confint(model)) %>% as_tibble()
fit$var = rownames(confint(model)) %>% gsub('class', '', .)
dplyr::tibble(
gene = gene,
# N = unique(data$N),
class = fit[2,]$var,
OR = fit[2,]$Estimate %>% exp(),
low = fit[2,]$`2.5 %` %>% exp(),
up = fit[2,]$`97.5 %` %>% exp(),
p.value = fit[2,]$`Pr(>|z|)`
)
fit
dplyr::tibble(
gene = gene,
# N = unique(data$N),
class = fit[2,]$var,
OR = fit[2,]$Estimate %>% exp(),
low = fit[2,]$`2.5 %` %>% exp(),
up = fit[2,]$`97.5 %` %>% exp(),
p.value = fit[2,]$`Pr(>|z|)`
)
fit
fit = dplyr::tibble(
gene = gene,
# N = unique(data$N),
class = fit[2,]$var,
OR = fit[2,]$Estimate %>% exp(),
low = fit[2,]$`2.5 %` %>% exp(),
up = fit[2,]$`97.5 %` %>% exp(),
p.value = fit[2,]$`Pr(>|z|)`
)
print(fit)
devtools::load_all()
met_propensity(x, tumor_type = 'BRCA', gene = 'TP53')
x = met_propensity(x, tumor_type = 'BRCA', gene = 'TP53')
x$metastatic_propensity$BRCA$TP53
metastic_site = 'Liver'
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(!grepl('Tier-2', class)) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(METASTATIC_SITE == metastic_site)
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(!grepl('Tier-2', class)) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::mutate(tropic = 1*(METASTATIC_SITE == metastic_site)) %>%
dplyr::select(class, tropic)
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(!grepl('Tier-2', class)) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::mutate(tropic = 1*(METASTATIC_SITE == metastic_site)) %>%
dplyr::select(class, tropic, SAMPLE_TYPE)
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(!grepl('Tier-2', class)) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Metastasis') %>%
dplyr::mutate(tropic = 1*(METASTATIC_SITE == metastic_site)) %>%
dplyr::select(class, tropic, SAMPLE_TYPE)
classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(!grepl('Tier-2', class)) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Metastasis') %>%
dplyr::mutate(tropic = 1*(METASTATIC_SITE == metastic_site)) %>%
dplyr::select(class, METASTATIC_SITE, tropic, SAMPLE_TYPE)
data = classification(x) %>%
dplyr::filter(tumor_type == !!tumor_type,
gene == !!gene) %>%
dplyr::filter(!grepl('Tier-2', class)) %>%
dplyr::group_by(sample) %>%
dplyr::slice_head(n = 1) %>%
dplyr::reframe(class = unique(class)) %>%
dplyr::left_join(clinical_data(x), by = 'sample') %>%
dplyr::filter(SAMPLE_TYPE == 'Metastasis') %>%
dplyr::mutate(tropic = 1*(METASTATIC_SITE == metastic_site)) %>%
dplyr::select(class, METASTATIC_SITE, tropic, SAMPLE_TYPE)
model = stats::glm(data = data, tropic ~ class, family = binomial(link = 'logit'))
fit = cbind(summary(model)$coefficients, confint(model)) %>% as_tibble()
fit$var = rownames(confint(model)) %>% gsub('class', '', .)
fit = dplyr::tibble(
gene = gene,
# N = unique(data$N),
class = fit[2,]$var,
OR = fit[2,]$Estimate %>% exp(),
low = fit[2,]$`2.5 %` %>% exp(),
up = fit[2,]$`97.5 %` %>% exp(),
p.value = fit[2,]$`Pr(>|z|)`
)
fit
devtools::load_all()
devtools::load_all()
metastic_site %in% clinical_data(x)$METASTATIC_SITE
devtools::load_all()
x = met_tropism(x, tumor_type = 'BRCA', gene = 'TP53', metastic_site = 'Liver')
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::build_site()
devtools::build_site()
traceback
traceback()
devtools::build_site()
devtools::build_site()
devtools::build_site()
devtools::document()
devtools::build_site()
devtools::document()
devtools::build_readme()
devtools::build_vignettes()
devtools::build_site()
